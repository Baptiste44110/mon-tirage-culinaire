<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Liste des plats</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <h1>üçõ Tous les plats enregistr√©s</h1>

  <div class="container" style="justify-content: center;">
    <div id="resultat" style="width: 100%;">
      <div id="liste" style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;"></div>
    </div>
  </div>

  <button id="btnRetourGestion" onclick="window.location.href='gestion.html'">‚Üê Retour √† la gestion des plats</button>
  <button onclick="sauvegarderSurFirebase()">üíæ Sauvegarder sur le cloud</button>
  <button onclick="chargerDepuisFirebase()">‚òÅÔ∏è Charger depuis le cloud</button>

  <script>
    let plats = JSON.parse(localStorage.getItem("platsPerso")) || [];

    // Tri alphab√©tique (insensible √† la casse)
    plats.sort((a, b) => a.nom.toLowerCase().localeCompare(b.nom.toLowerCase()));

    const liste = document.getElementById("liste");

    if (plats.length === 0) {
      liste.innerHTML = "<p>Aucun plat enregistr√©.</p>";
    } else {
      plats.forEach((plat, index) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <h3>${plat.nom}</h3>
          <p><strong>Pays :</strong> ${plat.pays}</p>
          <p><strong>Continent :</strong> ${plat.continent}</p>
          <p><em>${plat.description}</em></p>
          <button onclick="supprimerPlat(${index})">Supprimer ce plat</button>
        `;
        liste.appendChild(div);
      });
    }

    function supprimerPlat(index) {
      if (confirm("Voulez-vous vraiment supprimer ce plat ?")) {
        plats.splice(index, 1);
        localStorage.setItem("platsPerso", JSON.stringify(plats));
        location.reload();
      }
    }
  </script>

  <!-- Script type module pour Firebase et fonctions cloud -->
  <script type="module">
  import { sauvegarderPlatsFirebase, chargerPlatsFirebase } from "./firebase.js";

  window.sauvegarderSurFirebase = function () {
    const plats = JSON.parse(localStorage.getItem("platsPerso")) || [];

    if (plats.length === 0) {
      alert("Aucun plat √† sauvegarder.");
      return;
    }

    sauvegarderPlatsFirebase(plats)
      .then(() => {
        alert("‚úÖ Liste sauvegard√©e sur le cloud !");
      })
      .catch((error) => {
        console.error("Erreur lors de la sauvegarde :", error);
        alert("‚ùå √âchec de la sauvegarde sur le cloud.");
      });
  };

  window.chargerDepuisFirebase = function () {
    chargerPlatsFirebase()
      .then((data) => {
        if (data && Array.isArray(data)) {
          localStorage.setItem("platsPerso", JSON.stringify(data));
          alert("‚úÖ Liste charg√©e depuis le cloud !");
          location.reload();
        } else {
          alert("Aucune liste disponible sur le cloud.");
        }
      })
      .catch((err) => {
        console.error("Erreur lors du chargement :", err);
        alert("Erreur lors du chargement depuis le cloud.");
      });
  };
</script>


</body>
</html>
